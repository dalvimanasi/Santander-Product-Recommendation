{"paragraphs":[{"text":"%dep\nz.reset()\nz.addRepo(\"Spark Packages Repo\").url(\"http://dl.bintray.com/spark-packages/maven\")\nz.load(\"com.databricks:spark-csv_2.10:1.2.0\")\n\nimport org.apache.spark.sql.functions.udf\n\nimport util.Random._","dateUpdated":"2016-12-09T23:43:24-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481327650972_-197898848","id":"20161209-185410_1899505752","result":{"code":"ERROR","type":"TEXT","msg":"Must be used before SparkInterpreter (%spark) initialized\nHint: put this paragraph before any Spark code and restart Zeppelin/Interpreter"},"dateCreated":"2016-12-09T06:54:10-0500","dateStarted":"2016-12-09T23:43:24-0500","dateFinished":"2016-12-09T23:43:31-0500","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:7331"},{"text":"val trainData = sqlContext.read.format(\"com.databricks.spark.csv\").option(\"header\", \"true\").option(\"inferSchema\", \"true\").load(\"/home/sweta/Downloads/Santander/train_ver2.csv/train_ver2.csv\")","dateUpdated":"2016-12-09T23:43:40-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481329109517_-1494638914","id":"20161209-191829_735196351","result":{"code":"SUCCESS","type":"TEXT","msg":"\ntrainData: org.apache.spark.sql.DataFrame = [fecha_dato: timestamp, ncodpers: double ... 46 more fields]\n"},"dateCreated":"2016-12-09T07:18:29-0500","dateStarted":"2016-12-09T23:43:40-0500","dateFinished":"2016-12-09T23:47:49-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7332"},{"text":"trainData.toDF().registerTempTable(\"traindata\")","dateUpdated":"2016-12-09T23:50:19-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481330916340_-752835933","id":"20161209-194836_16492585","result":{"code":"SUCCESS","type":"TEXT","msg":"\nwarning: there was one deprecation warning; re-run with -deprecation for details\n"},"dateCreated":"2016-12-09T19:48:36-0500","dateStarted":"2016-12-09T23:50:19-0500","dateFinished":"2016-12-09T23:50:22-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7333"},{"text":"trainData.printSchema()","dateUpdated":"2016-12-09T23:49:20-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481331209728_-518728001","id":"20161209-195329_1514061439","result":{"code":"SUCCESS","type":"TEXT","msg":"root\n |-- fecha_dato: timestamp (nullable = true)\n |-- ncodpers: double (nullable = true)\n |-- ind_empleado: string (nullable = true)\n |-- pais_residencia: string (nullable = true)\n |-- sexo: string (nullable = true)\n |-- age: string (nullable = true)\n |-- fecha_alta: timestamp (nullable = true)\n |-- ind_nuevo: string (nullable = true)\n |-- antiguedad: string (nullable = true)\n |-- indrel: string (nullable = true)\n |-- ult_fec_cli_1t: timestamp (nullable = true)\n |-- indrel_1mes: string (nullable = true)\n |-- tiprel_1mes: string (nullable = true)\n |-- indresi: string (nullable = true)\n |-- indext: string (nullable = true)\n |-- conyuemp: string (nullable = true)\n |-- canal_entrada: string (nullable = true)\n |-- indfall: string (nullable = true)\n |-- tipodom: string (nullable = true)\n |-- cod_prov: string (nullable = true)\n |-- nomprov: string (nullable = true)\n |-- ind_actividad_cliente: string (nullable = true)\n |-- renta: double (nullable = true)\n |-- segmento: string (nullable = true)\n |-- ind_ahor_fin_ult1: integer (nullable = true)\n |-- ind_aval_fin_ult1: integer (nullable = true)\n |-- ind_cco_fin_ult1: integer (nullable = true)\n |-- ind_cder_fin_ult1: integer (nullable = true)\n |-- ind_cno_fin_ult1: integer (nullable = true)\n |-- ind_ctju_fin_ult1: integer (nullable = true)\n |-- ind_ctma_fin_ult1: integer (nullable = true)\n |-- ind_ctop_fin_ult1: integer (nullable = true)\n |-- ind_ctpp_fin_ult1: integer (nullable = true)\n |-- ind_deco_fin_ult1: integer (nullable = true)\n |-- ind_deme_fin_ult1: integer (nullable = true)\n |-- ind_dela_fin_ult1: integer (nullable = true)\n |-- ind_ecue_fin_ult1: integer (nullable = true)\n |-- ind_fond_fin_ult1: integer (nullable = true)\n |-- ind_hip_fin_ult1: integer (nullable = true)\n |-- ind_plan_fin_ult1: integer (nullable = true)\n |-- ind_pres_fin_ult1: integer (nullable = true)\n |-- ind_reca_fin_ult1: integer (nullable = true)\n |-- ind_tjcr_fin_ult1: integer (nullable = true)\n |-- ind_valo_fin_ult1: integer (nullable = true)\n |-- ind_viv_fin_ult1: integer (nullable = true)\n |-- ind_nomina_ult1: string (nullable = true)\n |-- ind_nom_pens_ult1: string (nullable = true)\n |-- ind_recibo_ult1: integer (nullable = true)\n\n"},"dateCreated":"2016-12-09T19:53:29-0500","dateStarted":"2016-12-09T23:49:20-0500","dateFinished":"2016-12-09T23:49:23-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7334"},{"text":"","dateUpdated":"2016-12-09T23:37:54-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481332737383_-1282627544","id":"20161209-201857_391231294","result":{"code":"SUCCESS","type":"TEXT","msg":"\nimport spark.implicits._\n"},"dateCreated":"2016-12-09T20:18:57-0500","dateStarted":"2016-12-09T23:34:32-0500","dateFinished":"2016-12-09T23:34:39-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7335"},{"text":"%md\n### Load clean and processed Train Data","dateUpdated":"2016-12-10T01:10:02-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481350147800_-1577408519","id":"20161210-010907_1955266190","result":{"code":"SUCCESS","type":"HTML","msg":"<h3>Load clean and processed Train Data</h3>\n"},"dateCreated":"2016-12-10T01:09:07-0500","dateStarted":"2016-12-10T01:09:32-0500","dateFinished":"2016-12-10T01:09:50-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7336"},{"text":"val cleanData = sqlContext.read.format(\"com.databricks.spark.csv\").option(\"header\", \"true\").option(\"inferSchema\", \"true\").load(\"/home/sweta/Downloads/Santander/train_ver2.csv/train_current_month_dataset.csv\")","dateUpdated":"2016-12-10T01:05:59-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481344472711_1095740949","id":"20161209-233432_1458916578","result":{"code":"SUCCESS","type":"TEXT","msg":"\ncleanData: org.apache.spark.sql.DataFrame = [fecha_dato: int, ncodpers: int ... 21 more fields]\n"},"dateCreated":"2016-12-09T23:34:32-0500","dateStarted":"2016-12-10T01:06:00-0500","dateFinished":"2016-12-10T01:06:15-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7337"},{"text":"cleanData.printSchema()","dateUpdated":"2016-12-10T01:20:00-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481350720113_932724478","id":"20161210-011840_1075808890","result":{"code":"SUCCESS","type":"TEXT","msg":"root\n |-- fecha_dato: integer (nullable = true)\n |-- ncodpers: integer (nullable = true)\n |-- ind_empleado: string (nullable = true)\n |-- pais_residencia: string (nullable = true)\n |-- sexo: string (nullable = true)\n |-- age: integer (nullable = true)\n |-- fecha_alta: timestamp (nullable = true)\n |-- ind_nuevo: integer (nullable = true)\n |-- antiguedad: integer (nullable = true)\n |-- indrel: integer (nullable = true)\n |-- indrel_1mes: integer (nullable = true)\n |-- tiprel_1mes: string (nullable = true)\n |-- indresi: string (nullable = true)\n |-- indext: string (nullable = true)\n |-- canal_entrada: string (nullable = true)\n |-- indfall: string (nullable = true)\n |-- nomprov: string (nullable = true)\n |-- ind_actividad_cliente: integer (nullable = true)\n |-- renta: double (nullable = true)\n |-- segmento: string (nullable = true)\n |-- new_products: string (nullable = true)\n |-- buy_class: integer (nullable = true)\n |-- n_new_products: integer (nullable = true)\n\n"},"dateCreated":"2016-12-10T01:18:40-0500","dateStarted":"2016-12-10T01:20:00-0500","dateFinished":"2016-12-10T01:20:03-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7338"},{"text":"val inputColumns = cleanData.drop(\"fecha_dato\",\"buy_class\",\"n_new_products\")\n\ninputColumns.printSchema()","dateUpdated":"2016-12-10T01:45:02-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481350818801_803018126","id":"20161210-012018_1227661150","result":{"code":"SUCCESS","type":"TEXT","msg":"\ninputColumns: org.apache.spark.sql.DataFrame = [ncodpers: int, ind_empleado: string ... 18 more fields]\nroot\n |-- ncodpers: integer (nullable = true)\n |-- ind_empleado: string (nullable = true)\n |-- pais_residencia: string (nullable = true)\n |-- sexo: string (nullable = true)\n |-- age: integer (nullable = true)\n |-- fecha_alta: timestamp (nullable = true)\n |-- ind_nuevo: integer (nullable = true)\n |-- antiguedad: integer (nullable = true)\n |-- indrel: integer (nullable = true)\n |-- indrel_1mes: integer (nullable = true)\n |-- tiprel_1mes: string (nullable = true)\n |-- indresi: string (nullable = true)\n |-- indext: string (nullable = true)\n |-- canal_entrada: string (nullable = true)\n |-- indfall: string (nullable = true)\n |-- nomprov: string (nullable = true)\n |-- ind_actividad_cliente: integer (nullable = true)\n |-- renta: double (nullable = true)\n |-- segmento: string (nullable = true)\n |-- new_products: string (nullable = true)\n\n"},"dateCreated":"2016-12-10T01:20:18-0500","dateStarted":"2016-12-10T01:45:02-0500","dateFinished":"2016-12-10T01:45:07-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7339"},{"text":"val testData = sqlContext.read.format(\"com.databricks.spark.csv\").option(\"header\", \"true\").option(\"inferSchema\", \"true\").load(\"/home/sweta/Downloads/Santander/test_data/test_ver2.csv\")\n\ntestData.printSchema()","dateUpdated":"2016-12-10T01:28:26-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481344593194_-1568124163","id":"20161209-233633_1490765044","result":{"code":"SUCCESS","type":"TEXT","msg":"\ntestData: org.apache.spark.sql.DataFrame = [fecha_dato: timestamp, ncodpers: double ... 22 more fields]\nroot\n |-- fecha_dato: timestamp (nullable = true)\n |-- ncodpers: double (nullable = true)\n |-- ind_empleado: string (nullable = true)\n |-- pais_residencia: string (nullable = true)\n |-- sexo: string (nullable = true)\n |-- age: double (nullable = true)\n |-- fecha_alta: timestamp (nullable = true)\n |-- ind_nuevo: integer (nullable = true)\n |-- antiguedad: double (nullable = true)\n |-- indrel: double (nullable = true)\n |-- ult_fec_cli_1t: timestamp (nullable = true)\n |-- indrel_1mes: double (nullable = true)\n |-- tiprel_1mes: string (nullable = true)\n |-- indresi: string (nullable = true)\n |-- indext: string (nullable = true)\n |-- conyuemp: string (nullable = true)\n |-- canal_entrada: string (nullable = true)\n |-- indfall: string (nullable = true)\n |-- tipodom: integer (nullable = true)\n |-- cod_prov: string (nullable = true)\n |-- nomprov: string (nullable = true)\n |-- ind_actividad_cliente: integer (nullable = true)\n |-- renta: string (nullable = true)\n |-- segmento: string (nullable = true)\n\n"},"dateCreated":"2016-12-09T23:36:33-0500","dateStarted":"2016-12-10T01:28:26-0500","dateFinished":"2016-12-10T01:28:54-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7340"},{"text":"%md \n#### To keep the Train and Test data in Sync\n##### Dropping the ult_fec_cli_1t, conyuemp from the Test DataSet and Add a Target column to the Test Dataset","dateUpdated":"2016-12-10T01:54:20-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481352125086_-1193008262","id":"20161210-014205_235957140","result":{"code":"SUCCESS","type":"HTML","msg":"<h4>To keep the Train and Test data in Sync</h4>\n<h5>Dropping the ult_fec_cli_1t, conyuemp from the Test DataSet and Add a Target column to the Test Dataset</h5>\n"},"dateCreated":"2016-12-10T01:42:05-0500","dateStarted":"2016-12-10T01:54:10-0500","dateFinished":"2016-12-10T01:54:10-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7341"},{"text":"val outputColumns = testData.drop(\"fecha_dato\",\"ult_fec_cli_1t\",\"conyuemp\",\"tipodom\",\"cod_prov\")\n\n//val outputColumn = outputColumns.withColumn(\"target\")\n\noutputColumns.printSchema()","dateUpdated":"2016-12-10T02:06:04-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481351129118_408461679","id":"20161210-012529_161467858","result":{"code":"SUCCESS","type":"TEXT","msg":"\noutputColumns: org.apache.spark.sql.DataFrame = [ncodpers: double, ind_empleado: string ... 17 more fields]\nroot\n |-- ncodpers: double (nullable = true)\n |-- ind_empleado: string (nullable = true)\n |-- pais_residencia: string (nullable = true)\n |-- sexo: string (nullable = true)\n |-- age: double (nullable = true)\n |-- fecha_alta: timestamp (nullable = true)\n |-- ind_nuevo: integer (nullable = true)\n |-- antiguedad: double (nullable = true)\n |-- indrel: double (nullable = true)\n |-- indrel_1mes: double (nullable = true)\n |-- tiprel_1mes: string (nullable = true)\n |-- indresi: string (nullable = true)\n |-- indext: string (nullable = true)\n |-- canal_entrada: string (nullable = true)\n |-- indfall: string (nullable = true)\n |-- nomprov: string (nullable = true)\n |-- ind_actividad_cliente: integer (nullable = true)\n |-- renta: string (nullable = true)\n |-- segmento: string (nullable = true)\n\n"},"dateCreated":"2016-12-10T01:25:29-0500","dateStarted":"2016-12-10T02:06:04-0500","dateFinished":"2016-12-10T02:06:06-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7342"},{"text":"%md\n### Load Libraries for Decision Tree","dateUpdated":"2016-12-10T02:43:12-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":false},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481354266077_-1506162695","id":"20161210-021746_1061394937","result":{"code":"SUCCESS","type":"HTML","msg":"<h3>Load Libraries for Decision Tree</h3>\n"},"dateCreated":"2016-12-10T02:17:46-0500","dateStarted":"2016-12-10T02:43:12-0500","dateFinished":"2016-12-10T02:43:12-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7343"},{"text":"import org.apache.spark.ml.Pipeline\nimport org.apache.spark.ml.classification.DecisionTreeClassificationModel\nimport org.apache.spark.ml.classification.DecisionTreeClassifier\nimport org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator\nimport org.apache.spark.ml.feature.{IndexToString, StringIndexer, VectorIndexer}","dateUpdated":"2016-12-10T02:43:23-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481352481746_-1713869617","id":"20161210-014801_858513982","result":{"code":"SUCCESS","type":"TEXT","msg":"\nimport org.apache.spark.ml.Pipeline\n\nimport org.apache.spark.ml.classification.DecisionTreeClassificationModel\n\nimport org.apache.spark.ml.classification.DecisionTreeClassifier\n\nimport org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator\n\nimport org.apache.spark.ml.feature.{IndexToString, StringIndexer, VectorIndexer}\n"},"dateCreated":"2016-12-10T01:48:01-0500","dateStarted":"2016-12-10T02:43:23-0500","dateFinished":"2016-12-10T02:43:27-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7344"},{"text":"// Index labels, adding metadata to the label column.\n// Fit on whole dataset to include all labels in index.\n//val labelIndexer1 = new StringIndexer()\n//  .setInputCol(\"new_products\")\n // .setOutputCol(\"indexedLabel1\")\n \n//val indexed1 = labelIndexer1.fit(inputColumns).transform(inputColumns)\n//indexed1.show()","dateUpdated":"2016-12-10T04:46:36-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481354260885_-651650712","id":"20161210-021740_88470899","result":{"code":"SUCCESS","type":"TEXT","msg":"\nlabelIndexer1: org.apache.spark.ml.feature.StringIndexer = strIdx_52db4dba98bc\n\nindexed1: org.apache.spark.sql.DataFrame = [ncodpers: int, ind_empleado: string ... 19 more fields]\n+--------+------------+---------------+----+---+--------------------+---------+----------+------+-----------+-----------+-------+------+-------------+-------+-----------+---------------------+---------+-----------------+------------+-------------+\n|ncodpers|ind_empleado|pais_residencia|sexo|age|          fecha_alta|ind_nuevo|antiguedad|indrel|indrel_1mes|tiprel_1mes|indresi|indext|canal_entrada|indfall|    nomprov|ind_actividad_cliente|    renta|         segmento|new_products|indexedLabel1|\n+--------+------------+---------------+----+---+--------------------+---------+----------+------+-----------+-----------+-------+------+-------------+-------+-----------+---------------------+---------+-----------------+------------+-------------+\n|   15924|           B|             ES|   V| 52|1995-01-16 00:00:...|        0|      7348|     1|          1|          A|      S|     N|          KAT|      N|PALMAS, LAS|                    1|130903.68|02 - PARTICULARES|        [18]|          2.0|\n|   15925|           F|             ES|   V| 62|1995-01-16 00:00:...|        0|      7348|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1| 42831.69|02 - PARTICULARES|        [23]|          0.0|\n|   15928|           B|             ES|   H| 49|1995-01-16 00:00:...|        0|      7348|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|263023.98|         01 - TOP|        [18]|          2.0|\n|   15965|           F|             ES|   H| 51|1995-01-16 00:00:...|        0|      7348|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1| 44353.17|         01 - TOP|      [7, 8]|        116.0|\n|   15965|           F|             ES|   H| 51|1995-01-16 00:00:...|        0|      7348|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1| 44353.17|         01 - TOP|      [7, 8]|        116.0|\n|   16026|           F|             ES|   H| 53|1995-02-06 00:00:...|        0|      7327|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|151911.54|02 - PARTICULARES|        [18]|          2.0|\n|   16027|           A|             ES|   V| 51|1995-02-08 00:00:...|        0|      7325|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|132941.25|         01 - TOP|         [4]|          6.0|\n|   16055|           N|             ES|   V| 55|1995-02-20 00:00:...|        0|      7313|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|267601.98|         01 - TOP|        [19]|         16.0|\n|   16149|           N|             ES|   H| 45|1995-02-24 00:00:...|        0|      7309|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1| 38874.57|02 - PARTICULARES|        [18]|          2.0|\n|   16162|           N|             ES|   V| 57|1995-02-28 00:00:...|        0|      7305|     1|          1|          A|      S|     N|          KAT|      N|  BARCELONA|                    1|215210.22|02 - PARTICULARES|         [2]|          3.0|\n|   16217|           N|             ES|   V| 75|1995-09-12 00:00:...|        0|      7109|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|183021.75|         01 - TOP|     [7, 22]|        147.0|\n|   16217|           N|             ES|   V| 75|1995-09-12 00:00:...|        0|      7109|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|183021.75|         01 - TOP|     [7, 22]|        147.0|\n|   16241|           F|             ES|   H| 48|1995-03-10 00:00:...|        0|      7295|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|129139.44|02 - PARTICULARES|        [23]|          0.0|\n|   16287|           N|             ES|   H| 55|1995-12-01 00:00:...|        0|      7029|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|203973.87|         01 - TOP|        [19]|         16.0|\n|   16498|           A|             ES|   H| 46|1995-04-20 00:00:...|        0|      7254|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|276093.24|02 - PARTICULARES|        [23]|          0.0|\n|   16521|           A|             ES|   H| 47|1995-12-18 00:00:...|        0|      7012|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|154057.74|         01 - TOP|        [13]|         18.0|\n|   16568|           N|             ES|   V| 71|1995-04-20 00:00:...|        0|      7254|     1|          1|          A|      S|     N|          KAT|      N|  CORUÑA, A|                    1| 70863.57|02 - PARTICULARES|        [12]|          5.0|\n|   16575|           N|             ES|   V| 70|1995-04-20 00:00:...|        0|      7254|     1|          1|          A|      S|     S|          KAT|      N|     MADRID|                    1| 48574.74|02 - PARTICULARES|         [4]|          6.0|\n|   16592|           N|             ES|   V| 50|1995-05-01 00:00:...|        0|      7243|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|132647.94|         01 - TOP|        [12]|          5.0|\n|   16613|           N|             ES|   V| 44|1995-04-22 00:00:...|        0|      7252|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1| 125132.7|02 - PARTICULARES|        [23]|          0.0|\n+--------+------------+---------------+----+---+--------------------+---------+----------+------+-----------+-----------+-------+------+-------------+-------+-----------+---------------------+---------+-----------------+------------+-------------+\nonly showing top 20 rows\n\n"},"dateCreated":"2016-12-10T02:17:40-0500","dateStarted":"2016-12-10T04:44:18-0500","dateFinished":"2016-12-10T04:44:24-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7345"},{"text":"inputColumns.printSchema()","dateUpdated":"2016-12-10T03:17:32-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481357837626_1289160061","id":"20161210-031717_1273230239","result":{"code":"SUCCESS","type":"TEXT","msg":"root\n |-- ncodpers: integer (nullable = true)\n |-- ind_empleado: string (nullable = true)\n |-- pais_residencia: string (nullable = true)\n |-- sexo: string (nullable = true)\n |-- age: integer (nullable = true)\n |-- fecha_alta: timestamp (nullable = true)\n |-- ind_nuevo: integer (nullable = true)\n |-- antiguedad: integer (nullable = true)\n |-- indrel: integer (nullable = true)\n |-- indrel_1mes: integer (nullable = true)\n |-- tiprel_1mes: string (nullable = true)\n |-- indresi: string (nullable = true)\n |-- indext: string (nullable = true)\n |-- canal_entrada: string (nullable = true)\n |-- indfall: string (nullable = true)\n |-- nomprov: string (nullable = true)\n |-- ind_actividad_cliente: integer (nullable = true)\n |-- renta: double (nullable = true)\n |-- segmento: string (nullable = true)\n |-- new_products: string (nullable = true)\n\n"},"dateCreated":"2016-12-10T03:17:17-0500","dateStarted":"2016-12-10T03:17:32-0500","dateFinished":"2016-12-10T03:17:33-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7346"},{"text":"%md\n## Feature Extraction\n#### Converting to Categorical Data using String Indexer","dateUpdated":"2016-12-10T07:46:23-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481373931390_-3582482","id":"20161210-074531_1359708043","result":{"code":"SUCCESS","type":"HTML","msg":"<h2>Feature Extraction</h2>\n<h4>Converting to Categorical Data using String Indexer</h4>\n"},"dateCreated":"2016-12-10T07:45:31-0500","dateStarted":"2016-12-10T07:46:19-0500","dateFinished":"2016-12-10T07:46:19-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7347"},{"text":"// Index labels, for adding the Features in the Vector Assembler \n//ind_empleado\nval ind_empleadoIndexer = new StringIndexer()\n  .setInputCol(\"ind_empleado\")\n  .setOutputCol(\"ind_empleadoIndex\")\n  \nval indexed2 = ind_empleadoIndexer.fit(inputColumns).transform(inputColumns)\n\n//pais_residencia\nval pais_residenciaIndexer = new StringIndexer()\n  .setInputCol(\"pais_residencia\")\n  .setOutputCol(\"pais_residenciaIndex\")\n  \nval indexed3 = pais_residenciaIndexer.fit(indexed2).transform(indexed2)\n\n//sexo\nval sexoIndexer = new StringIndexer()\n  .setInputCol(\"sexo\")\n  .setOutputCol(\"sexoIndex\")\n  \nval indexed4 = sexoIndexer.fit(indexed3).transform(indexed3)\n\n//fecha_alta\n//val fecha_altaIndexer = new StringIndexer()\n//  .setInputCol(\"fecha_alta\")\n//  .setOutputCol(\"fecha_altaIndex\")\n  \n//val indexed5 = fecha_altaIndexer.fit(indexed4).transform(indexed4)\n\n//tiprel_1mes\nval tiprel_1mesIndexer = new StringIndexer()\n  .setInputCol(\"tiprel_1mes\")\n  .setOutputCol(\"tiprel_1mesIndex\")\n  \nval indexed6 = tiprel_1mesIndexer.fit(indexed4).transform(indexed4)\n\n//indresi\nval indresiIndexer = new StringIndexer()\n  .setInputCol(\"indresi\")\n  .setOutputCol(\"indresiIndex\")\n  \nval indexed7 = indresiIndexer.fit(indexed6).transform(indexed6)\n\n//indext\nval indextIndexer = new StringIndexer()\n  .setInputCol(\"indext\")\n  .setOutputCol(\"indextIndex\")\n  \nval indexed8 = indextIndexer.fit(indexed7).transform(indexed7)\n\n//canal_entrada\nval canal_entradaIndexer = new StringIndexer()\n  .setInputCol(\"canal_entrada\")\n  .setOutputCol(\"canal_entradaIndex\")\n  \nval indexed9 = canal_entradaIndexer.fit(indexed8).transform(indexed8)\n\n//indfall\nval indfallIndexer = new StringIndexer()\n  .setInputCol(\"indfall\")\n  .setOutputCol(\"indfallIndex\")\n  \nval indexed10 = indfallIndexer.fit(indexed9).transform(indexed9)\n\n//nomprov\nval nomprovIndexer = new StringIndexer()\n  .setInputCol(\"nomprov\")\n  .setOutputCol(\"nomprovIndex\")\n  \nval indexed11 = nomprovIndexer.fit(indexed10).transform(indexed10)\n\n//nomprov\nval segmentoIndexer = new StringIndexer()\n  .setInputCol(\"segmento\")\n  .setOutputCol(\"segmentoIndex\")\n  \nval indexed12 = segmentoIndexer.fit(indexed11).transform(indexed11)\n\n\nindexed12.show()","dateUpdated":"2016-12-10T04:46:50-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481357701245_-1195010345","id":"20161210-031501_421014900","result":{"code":"SUCCESS","type":"TEXT","msg":"\nind_empleadoIndexer: org.apache.spark.ml.feature.StringIndexer = strIdx_c735774d54e3\n\nindexed2: org.apache.spark.sql.DataFrame = [ncodpers: int, ind_empleado: string ... 19 more fields]\n\npais_residenciaIndexer: org.apache.spark.ml.feature.StringIndexer = strIdx_2c5763a6b80b\n\nindexed3: org.apache.spark.sql.DataFrame = [ncodpers: int, ind_empleado: string ... 20 more fields]\n\nsexoIndexer: org.apache.spark.ml.feature.StringIndexer = strIdx_211f519ff8f0\n\nindexed4: org.apache.spark.sql.DataFrame = [ncodpers: int, ind_empleado: string ... 21 more fields]\n\ntiprel_1mesIndexer: org.apache.spark.ml.feature.StringIndexer = strIdx_b924ff252ba9\n\nindexed6: org.apache.spark.sql.DataFrame = [ncodpers: int, ind_empleado: string ... 22 more fields]\n\nindresiIndexer: org.apache.spark.ml.feature.StringIndexer = strIdx_67d9bcd5288d\n\nindexed7: org.apache.spark.sql.DataFrame = [ncodpers: int, ind_empleado: string ... 23 more fields]\n\nindextIndexer: org.apache.spark.ml.feature.StringIndexer = strIdx_a16bb32c355c\n\nindexed8: org.apache.spark.sql.DataFrame = [ncodpers: int, ind_empleado: string ... 24 more fields]\n\ncanal_entradaIndexer: org.apache.spark.ml.feature.StringIndexer = strIdx_b830e2da8743\n\nindexed9: org.apache.spark.sql.DataFrame = [ncodpers: int, ind_empleado: string ... 25 more fields]\n\nindfallIndexer: org.apache.spark.ml.feature.StringIndexer = strIdx_7c5cc41f794f\n\nindexed10: org.apache.spark.sql.DataFrame = [ncodpers: int, ind_empleado: string ... 26 more fields]\n\nnomprovIndexer: org.apache.spark.ml.feature.StringIndexer = strIdx_1d48c5cd8d65\n\nindexed11: org.apache.spark.sql.DataFrame = [ncodpers: int, ind_empleado: string ... 27 more fields]\n\nsegmentoIndexer: org.apache.spark.ml.feature.StringIndexer = strIdx_cd1c1732132e\n\nindexed12: org.apache.spark.sql.DataFrame = [ncodpers: int, ind_empleado: string ... 28 more fields]\n+--------+------------+---------------+----+---+--------------------+---------+----------+------+-----------+-----------+-------+------+-------------+-------+-----------+---------------------+---------+-----------------+------------+-----------------+--------------------+---------+----------------+------------+-----------+------------------+------------+------------+-------------+\n|ncodpers|ind_empleado|pais_residencia|sexo|age|          fecha_alta|ind_nuevo|antiguedad|indrel|indrel_1mes|tiprel_1mes|indresi|indext|canal_entrada|indfall|    nomprov|ind_actividad_cliente|    renta|         segmento|new_products|ind_empleadoIndex|pais_residenciaIndex|sexoIndex|tiprel_1mesIndex|indresiIndex|indextIndex|canal_entradaIndex|indfallIndex|nomprovIndex|segmentoIndex|\n+--------+------------+---------------+----+---+--------------------+---------+----------+------+-----------+-----------+-------+------+-------------+-------+-----------+---------------------+---------+-----------------+------------+-----------------+--------------------+---------+----------------+------------+-----------+------------------+------------+------------+-------------+\n|   15924|           B|             ES|   V| 52|1995-01-16 00:00:...|        0|      7348|     1|          1|          A|      S|     N|          KAT|      N|PALMAS, LAS|                    1|130903.68|02 - PARTICULARES|        [18]|              2.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         9.0|          0.0|\n|   15925|           F|             ES|   V| 62|1995-01-16 00:00:...|        0|      7348|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1| 42831.69|02 - PARTICULARES|        [23]|              3.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          0.0|\n|   15928|           B|             ES|   H| 49|1995-01-16 00:00:...|        0|      7348|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|263023.98|         01 - TOP|        [18]|              2.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   15965|           F|             ES|   H| 51|1995-01-16 00:00:...|        0|      7348|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1| 44353.17|         01 - TOP|      [7, 8]|              3.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   15965|           F|             ES|   H| 51|1995-01-16 00:00:...|        0|      7348|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1| 44353.17|         01 - TOP|      [7, 8]|              3.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   16026|           F|             ES|   H| 53|1995-02-06 00:00:...|        0|      7327|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|151911.54|02 - PARTICULARES|        [18]|              3.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          0.0|\n|   16027|           A|             ES|   V| 51|1995-02-08 00:00:...|        0|      7325|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|132941.25|         01 - TOP|         [4]|              1.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   16055|           N|             ES|   V| 55|1995-02-20 00:00:...|        0|      7313|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|267601.98|         01 - TOP|        [19]|              0.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   16149|           N|             ES|   H| 45|1995-02-24 00:00:...|        0|      7309|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1| 38874.57|02 - PARTICULARES|        [18]|              0.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          0.0|\n|   16162|           N|             ES|   V| 57|1995-02-28 00:00:...|        0|      7305|     1|          1|          A|      S|     N|          KAT|      N|  BARCELONA|                    1|215210.22|02 - PARTICULARES|         [2]|              0.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         1.0|          0.0|\n|   16217|           N|             ES|   V| 75|1995-09-12 00:00:...|        0|      7109|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|183021.75|         01 - TOP|     [7, 22]|              0.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   16217|           N|             ES|   V| 75|1995-09-12 00:00:...|        0|      7109|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|183021.75|         01 - TOP|     [7, 22]|              0.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   16241|           F|             ES|   H| 48|1995-03-10 00:00:...|        0|      7295|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|129139.44|02 - PARTICULARES|        [23]|              3.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          0.0|\n|   16287|           N|             ES|   H| 55|1995-12-01 00:00:...|        0|      7029|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|203973.87|         01 - TOP|        [19]|              0.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   16498|           A|             ES|   H| 46|1995-04-20 00:00:...|        0|      7254|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|276093.24|02 - PARTICULARES|        [23]|              1.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          0.0|\n|   16521|           A|             ES|   H| 47|1995-12-18 00:00:...|        0|      7012|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|154057.74|         01 - TOP|        [13]|              1.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   16568|           N|             ES|   V| 71|1995-04-20 00:00:...|        0|      7254|     1|          1|          A|      S|     N|          KAT|      N|  CORUÑA, A|                    1| 70863.57|02 - PARTICULARES|        [12]|              0.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         6.0|          0.0|\n|   16575|           N|             ES|   V| 70|1995-04-20 00:00:...|        0|      7254|     1|          1|          A|      S|     S|          KAT|      N|     MADRID|                    1| 48574.74|02 - PARTICULARES|         [4]|              0.0|                 0.0|      0.0|             0.0|         0.0|        1.0|               0.0|         0.0|         0.0|          0.0|\n|   16592|           N|             ES|   V| 50|1995-05-01 00:00:...|        0|      7243|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1|132647.94|         01 - TOP|        [12]|              0.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   16613|           N|             ES|   V| 44|1995-04-22 00:00:...|        0|      7252|     1|          1|          A|      S|     N|          KAT|      N|     MADRID|                    1| 125132.7|02 - PARTICULARES|        [23]|              0.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          0.0|\n+--------+------------+---------------+----+---+--------------------+---------+----------+------+-----------+-----------+-------+------+-------------+-------+-----------+---------------------+---------+-----------------+------------+-----------------+--------------------+---------+----------------+------------+-----------+------------------+------------+------------+-------------+\nonly showing top 20 rows\n\n"},"dateCreated":"2016-12-10T03:15:01-0500","dateStarted":"2016-12-10T04:46:50-0500","dateFinished":"2016-12-10T04:47:17-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7348"},{"text":"%md\n####Drop columns from indexed12","dateUpdated":"2016-12-10T07:22:56-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481357744565_79155418","id":"20161210-031544_1733812716","result":{"code":"SUCCESS","type":"HTML","msg":"<h4>Drop columns from indexed12</h4>\n"},"dateCreated":"2016-12-10T03:15:44-0500","dateStarted":"2016-12-10T03:46:56-0500","dateFinished":"2016-12-10T03:46:56-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7349"},{"text":"val inputIndexedColumns = indexed12.drop(\"ind_empleado\",\"pais_residencia\",\"sexo\",\"fecha_alta\",\"tiprel_1mes\",\"indresi\",\"indext\",\"canal_entrada\",\"indfall\",\"nomprov\",\"segmento\",\"renta\")\ninputIndexedColumns.show()","dateUpdated":"2016-12-10T04:58:43-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481359620398_-200291064","id":"20161210-034700_1748538625","result":{"code":"SUCCESS","type":"TEXT","msg":"\ninputIndexedColumns: org.apache.spark.sql.DataFrame = [ncodpers: int, age: int ... 16 more fields]\n+--------+---+---------+----------+------+-----------+---------------------+------------+-----------------+--------------------+---------+----------------+------------+-----------+------------------+------------+------------+-------------+\n|ncodpers|age|ind_nuevo|antiguedad|indrel|indrel_1mes|ind_actividad_cliente|new_products|ind_empleadoIndex|pais_residenciaIndex|sexoIndex|tiprel_1mesIndex|indresiIndex|indextIndex|canal_entradaIndex|indfallIndex|nomprovIndex|segmentoIndex|\n+--------+---+---------+----------+------+-----------+---------------------+------------+-----------------+--------------------+---------+----------------+------------+-----------+------------------+------------+------------+-------------+\n|   15924| 52|        0|      7348|     1|          1|                    1|        [18]|              2.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         9.0|          0.0|\n|   15925| 62|        0|      7348|     1|          1|                    1|        [23]|              3.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          0.0|\n|   15928| 49|        0|      7348|     1|          1|                    1|        [18]|              2.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   15965| 51|        0|      7348|     1|          1|                    1|      [7, 8]|              3.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   15965| 51|        0|      7348|     1|          1|                    1|      [7, 8]|              3.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   16026| 53|        0|      7327|     1|          1|                    1|        [18]|              3.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          0.0|\n|   16027| 51|        0|      7325|     1|          1|                    1|         [4]|              1.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   16055| 55|        0|      7313|     1|          1|                    1|        [19]|              0.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   16149| 45|        0|      7309|     1|          1|                    1|        [18]|              0.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          0.0|\n|   16162| 57|        0|      7305|     1|          1|                    1|         [2]|              0.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         1.0|          0.0|\n|   16217| 75|        0|      7109|     1|          1|                    1|     [7, 22]|              0.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   16217| 75|        0|      7109|     1|          1|                    1|     [7, 22]|              0.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   16241| 48|        0|      7295|     1|          1|                    1|        [23]|              3.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          0.0|\n|   16287| 55|        0|      7029|     1|          1|                    1|        [19]|              0.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   16498| 46|        0|      7254|     1|          1|                    1|        [23]|              1.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          0.0|\n|   16521| 47|        0|      7012|     1|          1|                    1|        [13]|              1.0|                 0.0|      1.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   16568| 71|        0|      7254|     1|          1|                    1|        [12]|              0.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         6.0|          0.0|\n|   16575| 70|        0|      7254|     1|          1|                    1|         [4]|              0.0|                 0.0|      0.0|             0.0|         0.0|        1.0|               0.0|         0.0|         0.0|          0.0|\n|   16592| 50|        0|      7243|     1|          1|                    1|        [12]|              0.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          2.0|\n|   16613| 44|        0|      7252|     1|          1|                    1|        [23]|              0.0|                 0.0|      0.0|             0.0|         0.0|        0.0|               0.0|         0.0|         0.0|          0.0|\n+--------+---+---------+----------+------+-----------+---------------------+------------+-----------------+--------------------+---------+----------------+------------+-----------+------------------+------------+------------+-------------+\nonly showing top 20 rows\n\n"},"dateCreated":"2016-12-10T03:47:00-0500","dateStarted":"2016-12-10T04:58:43-0500","dateFinished":"2016-12-10T04:58:45-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7350"},{"text":"%md \n#### Vector Fitting for Features","dateUpdated":"2016-12-10T07:47:14-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481374013670_-1240626817","id":"20161210-074653_327557178","result":{"code":"SUCCESS","type":"HTML","msg":"<h4>Vector Fitting for Features</h4>\n"},"dateCreated":"2016-12-10T07:46:53-0500","dateStarted":"2016-12-10T07:47:14-0500","dateFinished":"2016-12-10T07:47:14-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7351"},{"text":"// Make the Features\nimport org.apache.spark.mllib.linalg.Vectors\nimport org.apache.spark.ml.feature.VectorAssembler\n\n//Tried to reverse Engineer\nval assembler = new VectorAssembler()\n// .setInputCols(Array(\"ind_empleadoIndex\", \"pais_residenciaIndex\",\"sexoIndex\",\"ind_nuevo\",\"indrel\",\"indrel_1mes\",\"tiprel_1mesIndex\",\"indresiIndex\",\"indextIndex\",\"canal_entradaIndex\",\"indfallIndex\",\"ind_actividad_cliente\",\"segmentoIndex\", \"age\",\"renta\",\"antigaugeded\",\"nomprovIndex\"))\n // .setInputCols(Array(\"ind_empleadoIndex\", \"pais_residenciaIndex\",\"sexoIndex\",\"ind_nuevo\",\"indrel\",\"indrel_1mes\",\"tiprel_1mesIndex\",\"indresiIndex\",\"indextIndex\",\"canal_entradaIndex\",\"indfallIndex\",\"ind_actividad_cliente\",\"segmentoIndex\"))\n // .setInputCols(Array(\"ind_empleadoIndex\", \"pais_residenciaIndex\",\"sexoIndex\",\"ind_nuevo\",\"indrel\",\"indrel_1mes\",\"tiprel_1mesIndex\",\"indresiIndex\",\"indextIndex\",\"canal_entradaIndex\",\"indfallIndex\", segmentoIndex\"))\n // .setInputCols(Array(\"ind_empleadoIndex\", \"pais_residenciaIndex\",\"sexoIndex\",\"ind_nuevo\",\"indrel\",\"indrel_1mes\",\"tiprel_1mesIndex\",\"indresiIndex\",\"indextIndex\",\"canal_entradaIndex\", segmentoIndex\"))\n  .setInputCols(Array(\"sexoIndex\",\"segmentoIndex\"))\n  .setOutputCol(\"features\")\n  \nval indexed13 = assembler.transform(indexed12)\nprintln(indexed13.select(\"features\", \"new_products\").first())","dateUpdated":"2016-12-10T07:03:58-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481354296462_-86793354","id":"20161210-021816_659276529","result":{"code":"SUCCESS","type":"TEXT","msg":"\nimport org.apache.spark.mllib.linalg.Vectors\n\nimport org.apache.spark.ml.feature.VectorAssembler\n\nassembler: org.apache.spark.ml.feature.VectorAssembler = vecAssembler_d6af54bb6509\n\nindexed13: org.apache.spark.sql.DataFrame = [ncodpers: int, ind_empleado: string ... 29 more fields]\n[(2,[],[]),[18]]\n"},"dateCreated":"2016-12-10T02:18:16-0500","dateStarted":"2016-12-10T05:32:06-0500","dateFinished":"2016-12-10T05:32:10-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7352"},{"text":"val labelIndexer = new StringIndexer()\n  .setInputCol(\"new_products\")\n  .setOutputCol(\"indexedLabel\")\n  .fit(indexed13)","dateUpdated":"2016-12-10T05:32:11-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481362904094_-1465181586","id":"20161210-044144_21132342","result":{"code":"SUCCESS","type":"TEXT","msg":"\nlabelIndexer: org.apache.spark.ml.feature.StringIndexerModel = strIdx_4318b9fc7c4a\n"},"dateCreated":"2016-12-10T04:41:44-0500","dateStarted":"2016-12-10T05:32:11-0500","dateFinished":"2016-12-10T05:32:15-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7353"},{"text":"// Automatically identify categorical features, and index them.\nimport org.apache.spark.ml.feature.VectorIndexer\n\nval featureIndexer = new VectorIndexer()\n  .setInputCol(\"features\")\n  .setOutputCol(\"indexedFeatures\")\n // .setMaxCategories(4) // features with > 4 distinct values are treated as continuous.\n  .fit(indexed13)","dateUpdated":"2016-12-10T05:32:38-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481354338623_-560141770","id":"20161210-021858_519081771","result":{"code":"SUCCESS","type":"TEXT","msg":"\nimport org.apache.spark.ml.feature.VectorIndexer\n\nfeatureIndexer: org.apache.spark.ml.feature.VectorIndexerModel = vecIdx_ba22a75a9663\n"},"dateCreated":"2016-12-10T02:18:58-0500","dateStarted":"2016-12-10T05:32:38-0500","dateFinished":"2016-12-10T05:32:44-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7354"},{"text":"import org.apache.spark.ml.Pipeline\nimport org.apache.spark.ml.classification.{RandomForestClassificationModel, RandomForestClassifier}\nimport org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator\nimport org.apache.spark.ml.feature.{IndexToString, StringIndexer, VectorIndexer}","dateUpdated":"2016-12-10T05:32:42-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481361420877_1718520328","id":"20161210-041700_471212364","result":{"code":"SUCCESS","type":"TEXT","msg":"\nimport org.apache.spark.ml.Pipeline\n\nimport org.apache.spark.ml.classification.{RandomForestClassificationModel, RandomForestClassifier}\n\nimport org.apache.spark.ml.evaluation.MulticlassClassificationEvaluator\n\nimport org.apache.spark.ml.feature.{IndexToString, StringIndexer, VectorIndexer}\n"},"dateCreated":"2016-12-10T04:17:00-0500","dateStarted":"2016-12-10T05:32:42-0500","dateFinished":"2016-12-10T05:32:45-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7355"},{"text":"// Split the data into training and test sets (30% held out for testing).\nval Array(trainingData, testData) = indexed13.randomSplit(Array(0.7, 0.3))","dateUpdated":"2016-12-10T05:32:47-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481361448150_1503476342","id":"20161210-041728_1214893974","result":{"code":"SUCCESS","type":"TEXT","msg":"\n\ntrainingData: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [ncodpers: int, ind_empleado: string ... 29 more fields]\ntestData: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [ncodpers: int, ind_empleado: string ... 29 more fields]\n"},"dateCreated":"2016-12-10T04:17:28-0500","dateStarted":"2016-12-10T05:32:47-0500","dateFinished":"2016-12-10T05:32:47-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7356"},{"text":"// Train a RandomForest model.\nval rf = new RandomForestClassifier()\n  .setLabelCol(\"indexedLabel\")\n  .setFeaturesCol(\"indexedFeatures\")\n  .setNumTrees(100)","dateUpdated":"2016-12-10T05:32:51-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481361544435_-682896771","id":"20161210-041904_264771601","result":{"code":"SUCCESS","type":"TEXT","msg":"\nrf: org.apache.spark.ml.classification.RandomForestClassifier = rfc_39c8a9fa5b7e\n"},"dateCreated":"2016-12-10T04:19:04-0500","dateStarted":"2016-12-10T05:32:51-0500","dateFinished":"2016-12-10T05:32:53-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7357"},{"text":"// Convert indexed labels back to original labels.\nval labelConverter = new IndexToString()\n  .setInputCol(\"prediction\")\n  .setOutputCol(\"predictedLabel\")\n  .setLabels(labelIndexer.labels)\n ","dateUpdated":"2016-12-10T05:32:57-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481361711557_-1307516091","id":"20161210-042151_338082599","result":{"code":"SUCCESS","type":"TEXT","msg":"\nlabelConverter: org.apache.spark.ml.feature.IndexToString = idxToStr_102799d37e98\n"},"dateCreated":"2016-12-10T04:21:51-0500","dateStarted":"2016-12-10T05:32:57-0500","dateFinished":"2016-12-10T05:32:58-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7358"},{"text":"\n// Chain indexers and forest in a Pipeline.\nval pipeline = new Pipeline()\n  .setStages(Array(labelIndexer, featureIndexer, rf, labelConverter))","dateUpdated":"2016-12-10T05:32:59-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481361945198_1851594186","id":"20161210-042545_185133997","result":{"code":"SUCCESS","type":"TEXT","msg":"\npipeline: org.apache.spark.ml.Pipeline = pipeline_ec8245842d21\n"},"dateCreated":"2016-12-10T04:25:45-0500","dateStarted":"2016-12-10T05:32:59-0500","dateFinished":"2016-12-10T05:33:00-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7359"},{"text":"// Train model. This also runs the indexers.\nval model = pipeline.fit(trainingData)","dateUpdated":"2016-12-10T05:33:03-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481362671286_-845272843","id":"20161210-043751_1867390052","result":{"code":"SUCCESS","type":"TEXT","msg":"\nmodel: org.apache.spark.ml.PipelineModel = pipeline_ec8245842d21\n"},"dateCreated":"2016-12-10T04:37:51-0500","dateStarted":"2016-12-10T05:33:03-0500","dateFinished":"2016-12-10T05:40:49-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7360"},{"text":"// Make predictions.\nval predictions = model.transform(testData)","dateUpdated":"2016-12-10T07:00:00-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481363401597_556630080","id":"20161210-045001_33907129","result":{"code":"SUCCESS","type":"TEXT","msg":"\npredictions: org.apache.spark.sql.DataFrame = [ncodpers: int, ind_empleado: string ... 35 more fields]\n"},"dateCreated":"2016-12-10T04:50:01-0500","dateStarted":"2016-12-10T05:41:10-0500","dateFinished":"2016-12-10T05:41:13-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7361"},{"text":"%md\n#### Product Prediction for Users","dateUpdated":"2016-12-10T07:45:22-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/markdown","editorHide":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481373901990_420998058","id":"20161210-074501_527314121","result":{"code":"SUCCESS","type":"HTML","msg":"<h4>Product Prediction for Users</h4>\n"},"dateCreated":"2016-12-10T07:45:01-0500","dateStarted":"2016-12-10T07:45:19-0500","dateFinished":"2016-12-10T07:45:20-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7362"},{"text":"// Select example rows to display.\npredictions.select(\"predictedLabel\", \"new_products\", \"features\").show(5)","dateUpdated":"2016-12-10T06:53:46-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481363766475_-1423599177","id":"20161210-045606_52007839","result":{"code":"SUCCESS","type":"TEXT","msg":"+--------------+------------+---------+\n|predictedLabel|new_products| features|\n+--------------+------------+---------+\n|          [18]|        [18]|[0.0,2.0]|\n|          [18]|         [2]|[1.0,2.0]|\n|          [23]|         [7]|(2,[],[])|\n|          [23]|         [2]|(2,[],[])|\n|          [18]|        [22]|[0.0,2.0]|\n+--------------+------------+---------+\nonly showing top 5 rows\n\n"},"dateCreated":"2016-12-10T04:56:06-0500","dateStarted":"2016-12-10T06:53:46-0500","dateFinished":"2016-12-10T07:03:28-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:7363"},{"text":"// Select (prediction, true label) and compute test error.\nval evaluator = new MulticlassClassificationEvaluator()\n  .setLabelCol(\"indexedLabel\")\n  .setPredictionCol(\"prediction\")\n  .setMetricName(\"accuracy\")\nval accuracy = evaluator.evaluate(predictions)\nprintln(\"Test Error = \" + (1.0 - accuracy))","dateUpdated":"2016-12-10T07:01:37-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481371285255_563029007","id":"20161210-070125_323130239","dateCreated":"2016-12-10T07:01:25-0500","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:7364"},{"text":"// Select (prediction, true label) and compute test error.\nval evaluator = new MulticlassClassificationEvaluator()\n  .setLabelCol(\"indexedLabel\")\n  .setPredictionCol(\"prediction\")\n  .setMetricName(\"accuracy\")\nval accuracy = evaluator.evaluate(predictions)\nprintln(\"Test Error = \" + (1.0 - accuracy))","dateUpdated":"2016-12-10T06:59:13-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481371023616_-276476124","id":"20161210-065703_1730643884","dateCreated":"2016-12-10T06:57:03-0500","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:7365"},{"text":"val rfModel = model.stages(2).asInstanceOf[RandomForestClassificationModel]\nprintln(\"Learned classification forest model:\\n\" + rfModel.toDebugString)","dateUpdated":"2016-12-10T04:56:52-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1481363800254_-1955645609","id":"20161210-045640_1540231430","dateCreated":"2016-12-10T04:56:40-0500","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:7366"}],"name":"Data Modelling - Random Forest Algorithm","id":"2C45Q8877","angularObjects":{"2C5UJSTVW:shared_process":[],"2C4RA1W2V:shared_process":[],"2C5GF69A5:shared_process":[],"2C5DMFP4T:shared_process":[],"2C4915JWF:shared_process":[],"2C5NA4PFU:shared_process":[],"2C4JG2HXW:shared_process":[],"2C51X336Z:shared_process":[],"2C54H2HWS:shared_process":[],"2C66HMKPJ:shared_process":[],"2C3DXPFSC:shared_process":[],"2C5QNRKFY:shared_process":[],"2C53AB6KB:shared_process":[],"2C3NVZF14:shared_process":[],"2C65WAQQ8:shared_process":[],"2C43YWVR5:shared_process":[],"2C2W13K3N:shared_process":[],"2C5SC6UPR:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}